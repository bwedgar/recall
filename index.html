<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"> 
<meta name="viewport" content="width=device-width" />
<link rel="stylesheet" href="style.css" /> </head> <body> <table id="selectedItemsTable">
<tr onclick="clickTable(this)"> <td></td>
<td style="display:none;"></td> </tr>
<tr onclick="clickTable(this)"> <td ></td> <td style="display:none;"></td> </tr> <tr onclick="clickTable(this)"> 
<td ></td> <td style="display:none;"></td> </tr> <tr onclick="clickTable(this)"> <td></td> <td style="display:none;"></td> </tr> <tr onclick="clickTable(this)"> <td></td> 
<td style="display:none;"></td> </tr> </table> <input type="text" id="search" oninput="updateTable(this)"> <button type="button" onclick="addNewItem()">Add New</button> 

<table id="linksTable"> <tr onclick="clickLinksTable(this)"> <td></td> <td></td> <td></td> </tr> <tr onclick="clickLinksTable(this)"> <td></td> <td></td> <td></td> </tr>
<tr onclick="clickLinksTable(this)"> <td></td> <td></td> <td></td> </tr> <tr onclick="clickLinksTable(this)"> <td></td> <td></td> <td></td> </tr> </table> 

<input type="text" id="description" oninput="updateTable(this)";> 

<input type="text" id="linkTo" > <button type="button" onclick="addNewItem()">Add New</button> 

<script src="https://unpkg.com/dexie/dist/dexie.js"></script> 

<script>

selectedItemsTable=document.getElementById("selectedItemsTable");
rows=0; operation="search";
linksTable=document.getElementById("linksTable");
//when an item is selected frim the search table ... function clickTable(x) { rows=0 for (row of linksTable.rows){ for (cell of row.cells) { cell.innerHTML="" } }
//if the operation is search (or add) item //add the links for the item to other items 
db.links.where("idFrom") .equals( parseInt(x.cells[1].innerHTML)) 
.toArray() 
.then(array =>{ array.map((e,i)=>{ rows++ db.items.get(e.idTo) 
.then(a=>a.item) 
.then(w=>linksTable.rows[i].cells[1].innerHTML=w.toString()) db.items.get(e.idDesc) 
.then(a=>a.item) .then(w=>linksTable.rows[i].cells[0].innerHTML=" is "+w.toString()) }) }) 
//add the links to the item 
db.links.where("idTo") 
.equals( parseInt(x.cells[1].innerHTML)) 
.toArray() .then(array =>{ array.map((e,i)=>{ db.items.get(e.idFrom) 
.then(a=>a.item) .then(w=>linksTable.rows[i+rows].cells[0].innerHTML=w.toString()+" is ") 
db.items.get(e.idDesc) 
.then(a=>a.item) 
.then(w=>linksTable.rows[i+rows].cells[1].innerHTML=w.toString()) }) }) } 
function updateTable(e) { 
operation ="search"; showItems(e.value); } 

function addNewItem() { db.items.add({item: search.value}); } 

function clickLinksTable() { } var db = new Dexie("links9"); db.version(1).stores({ items: " ++id, item", links: " ++idLink, idFrom, idTo, idDesc" }); 

function populateDb(){ db.items.bulkPut([ { item: "King Charles" }, { item: "Prince Harry" }, { item: "Prince William" }, { item: "Archie" }, { item: "Father of" }, { item: "Queen Elizabeth"}, { item: "Queen Mary"}, { item: "Diana Spencer"}, { item: "mother of"}, { item: "spouse of"}, { item: "Kate Middleton"} ]); 
db.links.bulkPut([ { idFrom: 1, idTo: 2, idDesc: 5}, { idFrom: 1, idTo: 3, idDesc: 5}, { idFrom: 6, idTo: 1, idDesc: 9} ]); } 

populateDb(); //search for an item function showItems(string) { //clear search table for (row of selectedItemsTable.rows){ for (cell of row.cells) { cell.innerHTML="" } }db.items.where("item").startsWithAnyOfIgnoreCase(string).toArray().then( selectedItems => { for (i=0;i<3;i++) { selectedItemsTable.rows[i].cells[0].innerHTML=selectedItems[i].item; selectedItemsTable.rows[i].cells[1].innerHTML=selectedItems[i].id; } }); } showItems("a");

</script> </body> </html>
